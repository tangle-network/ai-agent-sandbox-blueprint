# ─────────────────────────────────────────────────────────────────────────────
# AI Agent Sandbox Blueprint — Environment Variables
# ─────────────────────────────────────────────────────────────────────────────

# ── Core ──────────────────────────────────────────────────────────────────────

# Directory for persistent JSON stores (sandboxes, workflows, provisions)
BLUEPRINT_STATE_DIR=/var/lib/sandbox-blueprint

# Secret key for PASETO session tokens (min 32 bytes, generate with: openssl rand -hex 32)
SESSION_AUTH_SECRET=

# ── Docker / Sidecar ──────────────────────────────────────────────────────────

# Sidecar container image
SIDECAR_IMAGE=ghcr.io/tangle-network/sidecar:latest

# Host/port the sidecar is reachable at (from outside the container network)
SIDECAR_PUBLIC_HOST=127.0.0.1
SIDECAR_HTTP_PORT=8080
SIDECAR_SSH_PORT=22

# Pull sidecar image on first use (set false if pre-cached)
SIDECAR_PULL_IMAGE=true

# Optional: Docker daemon socket (defaults to local socket)
# DOCKER_HOST=unix:///var/run/docker.sock

# ── Operator API ──────────────────────────────────────────────────────────────

# Port for the operator HTTP API (default: 9090)
# When running under the Blueprint Manager (BPM), a port is allocated
# automatically; this value is used as the preferred/fallback port.
OPERATOR_API_PORT=9090

# CORS allowed origins (comma-separated).
# - "none"  → disabled (use when behind BPM proxy)
# - "*"     → allow all (dev mode only, NEVER in production)
# - origins → strict whitelist, e.g. "https://app.example.com,https://admin.example.com"
CORS_ALLOWED_ORIGINS=none

# Request timeout for sidecar proxied calls (seconds)
REQUEST_TIMEOUT_SECS=30

# ── Blueprint Manager Bridge (automatic when running under BPM) ──────────────

# Socket path for gRPC communication with the Blueprint Manager.
# Set automatically by the BPM when it spawns the blueprint process.
# When set, operator API binds to 127.0.0.1 and registers with the
# BPM auth proxy (port 8276) for secure external access.
# BRIDGE_SOCKET_PATH=/run/blueprint-manager/sandbox.sock

# Allow startup without BPM bridge (dev mode only, NEVER in production).
# When false (default), the blueprint refuses to start if the bridge is
# unavailable — ensuring the operator API is never exposed directly.
ALLOW_STANDALONE=false

# ── Workflows ─────────────────────────────────────────────────────────────────

# Cron expression for workflow tick evaluation
WORKFLOW_CRON_SCHEDULE=0 * * * * *

# ── Billing / Escrow Watchdog (instance blueprint) ────────────────────────

# Tangle core contract address (enables escrow watchdog when set)
# TANGLE_CONTRACT_ADDRESS=0x...

# HTTP RPC endpoint for read-only escrow balance checks
# HTTP_RPC_ENDPOINT=http://127.0.0.1:8545

# Blueprint ID (required for subscription rate lookups)
# BLUEPRINT_ID=0

# How often to check escrow balance (seconds, default: 300 = 5 min)
# ESCROW_CHECK_INTERVAL_SECS=300

# How many consecutive failures before auto-deprovision (default: 3)
# ESCROW_MAX_CONSECUTIVE_FAILURES=3

# Subscription billing keeper: calls billSubscriptionBatch on-chain.
# Activated automatically when TANGLE_CONTRACT_ADDRESS is set.

# How often to check for billable services (seconds, default: 60)
# BILLING_CHECK_INTERVAL_SECS=60

# How often to rescan for new subscription services (seconds, default: 300)
# BILLING_RESCAN_INTERVAL_SECS=300

# ── TEE (optional) ────────────────────────────────────────────────────────────

# Backend selection: phala | nitro | aws | gcp | azure | direct
# Leave unset for non-TEE operators.
# TEE_BACKEND=phala

# Phala dstack
# PHALA_API_KEY=
# PHALA_API_ENDPOINT=https://cloud.phala.network

# AWS Nitro Enclaves
# AWS_REGION=us-east-1
# AWS_NITRO_INSTANCE_TYPE=c5.xlarge
# AWS_NITRO_KMS_KEY_ID=
# AWS_NITRO_IAM_INSTANCE_PROFILE=
# AWS_NITRO_SUBNET_ID=
# AWS_NITRO_SECURITY_GROUP_ID=

# GCP Confidential Space
# GCP_PROJECT_ID=
# GCP_ZONE=us-central1-a
# GCP_MACHINE_TYPE=n2d-standard-4
# GCP_SERVICE_ACCOUNT_EMAIL=
# GCP_NETWORK=default
# GCP_SUBNET=default
# GCP_KMS_KEY_RESOURCE=

# Azure Confidential VMs + SKR
# AZURE_SUBSCRIPTION_ID=
# AZURE_RESOURCE_GROUP=
# AZURE_LOCATION=eastus
# AZURE_VM_SIZE=Standard_DC4as_v5
# AZURE_KEY_VAULT_URL=
# AZURE_MAA_ENDPOINT=

# Direct (operator-managed hardware)
# TEE_DIRECT_TYPE=tdx  # tdx | sev | nitro
